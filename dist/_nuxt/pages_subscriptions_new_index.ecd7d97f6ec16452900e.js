webpackJsonp([56],{"5Ul5":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("vjS3"),r=e("mr1+"),n=e("VU/8")(s.a,r.a,!1,null,null,null);n.options.__file="pages/subscriptions/new/index.vue",a.default=n.exports},"mr1+":function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("overlay-scrollbars",{staticClass:"main-content-wrap"},[e("div",{staticClass:"d-flx-alc-jsb page-extras"},[e("nuxt-link",{staticClass:"text-link",attrs:{to:"/subscriptions"}},[e("svg",[e("use",{attrs:{href:"/uploads/icons.svg#back"}})]),e("span",{staticClass:"ml-1 fw-bold co-grey"},[t._v("Back")])]),e("div",{staticClass:"search-filter d-flx-alc-jfe"},[e("label",{staticClass:"search-w-icon"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],attrs:{type:"text",placeholder:"Search"},domProps:{value:t.search},on:{input:function(a){a.target.composing||(t.search=a.target.value)}}}),e("svg",[e("use",{attrs:{href:"/uploads/icons.svg#search"}})])])])],1),e("div",{attrs:{id:"parent-component"}},[e("div",{attrs:{id:"subscription","uk-modal":"",container:"#parent-component","data-uk-modal":"{bgclose:false}"}},[e("div",{staticClass:"uk-modal-dialog uk-margin-auto-vertical modal"},[e("button",{staticClass:"uk-modal-close-default",attrs:{type:"button"},on:{click:t.cancelModal}},[t._v("X")]),e("div",{staticClass:"modal-header"},[e("h2",[t._v("Subscribe")]),e("p",[t._v("Fill details to subscribe to a plan")])]),e("form",{on:{submit:function(a){return a.preventDefault(),t.paySubscription.apply(null,arguments)}}},[e("overlay-scrollbars",{staticClass:"modal-body",attrs:{"uk-overflow-auto":""}},[e("label",{staticClass:"form-input"},[e("span",{staticClass:"form-input__label"},[t._v("Plan name")]),e("div",{staticClass:"form-input__input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.modalData.planname,expression:"modalData.planname"}],attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:t.modalData.planname},on:{input:function(a){a.target.composing||t.$set(t.modalData,"planname",a.target.value)}}})])]),e("label",{staticClass:"form-input"},[e("span",{staticClass:"form-input__label"},[t._v("Type")]),e("div",{staticClass:"form-input__input"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.formData.subscriptiontype,expression:"formData.subscriptiontype"}],on:{change:[function(a){var e=Array.prototype.filter.call(a.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.formData,"subscriptiontype",a.target.multiple?e:e[0])},function(a){return t.getPlanAmount(a)}]}},[e("option",{attrs:{value:""}},[t._v("-Select-")]),e("option",{attrs:{value:"monthly"}},[t._v("Monthly")]),e("option",{attrs:{value:"quarterly"}},[t._v("Quarterly")]),e("option",{attrs:{value:"yearly"}},[t._v("Annually")])])]),t.errorData.subscriptiontype?e("span",{staticClass:"form-input__error-msg"},[t._v("Please select a subscription type")]):t._e()]),e("label",{staticClass:"form-input"},[e("span",{staticClass:"form-input__label"},[t._v("Plan amount")]),e("div",{staticClass:"form-input__input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.modalData.amount,expression:"modalData.amount"}],attrs:{type:"text",placeholder:"",readonly:""},domProps:{value:t.modalData.amount},on:{input:function(a){a.target.composing||t.$set(t.modalData,"amount",a.target.value)}}})])])]),e("div",{staticClass:"d-flx-alc-jfe mt-3"},[e("button",{staticClass:"btn btn-no-fill",attrs:{type:"button"},on:{click:t.cancelModal}},[t._v("\n                Cancel\n              ")]),e("button",{staticClass:"btn btn--primary ml-1",attrs:{type:"submit",id:"submitBtn"}},[t._v("\n                + Subscribe\n              ")])])],1)])])]),e("div",{staticClass:"inner-main-wrapper"},[e("section",{staticClass:"section-wrapper"},[t.loading?e("ul",{staticClass:"card-list"},[e("li",{staticClass:"box-deco-bg  px-0 pb-0"},[e("div",{staticClass:"card-item__content mt-0 px-2"},[e("div",{staticClass:"card-item__main"},[e("h3",{staticClass:"card-item__main--title"},[t._v("\n                  Loading....Please wait\n                ")])]),e("br"),e("p",{staticClass:"card-item__status"})])])]):t._e(),t.loading?t._e():e("ul",{staticClass:"card-list none flex-width-1-3wgr"},t._l(t.filteredList,function(a,s){return e("li",{key:s,staticClass:"box-deco-bg px-0 pb-0"},[e("a",{staticClass:"card-item d-blk",attrs:{href:"javascript:;"},on:{click:function(e){return t.subscribe(a)}}},[e("div",{staticClass:"card-item__content mt-0 px-2"},[e("div",{staticClass:"card-item__main"},[e("h3",{staticClass:"card-item__main--title"},[t._v("\n                    "+t._s(a.licensename)+"\n                  ")]),e("p",{staticClass:"card-item__main--count"},[t._v(t._s(a.licensedescription))])]),e("p",{staticClass:"card-item__status"})]),e("p",{staticClass:"price px-2"},[e("span",[t._v("Users:")]),t._v(" "+t._s(a.nosofriders)+" "),e("br"),e("span",[t._v("Riders:")]),t._v(" "+t._s(a.nosofusers)+"\n              ")])]),e("br"),e("div",{staticClass:"card-item__drop"},["Free Trial"!==a.licensename?e("div",{staticClass:"drop-down org-drop drop-set"},[e("button",{staticClass:"btn btn-btn"},[e("a",{staticClass:"icon-text",attrs:{href:"javascript:;"},on:{click:function(e){return t.subscribe(a)}}},[e("svg",{},[e("use",{attrs:{"xlink:href":"/uploads/icons.svg#view"}})]),e("span",[t._v("\n\t\t\t\t\t\t\tSubscribe\n\t\t\t\t\t\t")])])])]):t._e()])])}),0)]),e("form",{staticStyle:{display:"none"},attrs:{method:"post",id:"subscribe",action:"https://www.globalpay.com.ng/GlobalPayAPI/Paymentgatewaycapture.aspx"}},[t._v("\n\t\t\t\tNames: "),e("input",{attrs:{type:"text",id:"names",name:"names"},domProps:{value:t.user.contactpersonlastname+" "+t.user.contactpersonfirstname}}),e("br"),t._v("\n\t\t\t\tAmount: "),e("input",{attrs:{type:"text",id:"amount",name:"amount"},domProps:{value:t.modalData.amount}}),e("br"),t._v("\n\t\t\t\tEmail Address: "),e("input",{attrs:{type:"text",id:"email_address",name:"email_address"},domProps:{value:t.user.merchantemailaddress}}),e("br"),t._v("\n\t\t\t\tPhone Number: "),e("input",{attrs:{type:"text",id:"phone_number",name:"phone_number"},domProps:{value:t.user.merchantphonenumber}}),e("br"),e("input",{attrs:{type:"hidden",id:"currency",name:"currency",value:"NGN"}}),e("br"),e("input",{attrs:{type:"text",id:"merch_txnref",name:"merch_txnref"},domProps:{value:t.generateRefNumber(10).toLowerCase()}}),e("input",{attrs:{type:"hidden",id:"merchantid",name:"merchantid",value:"3339"}}),e("br"),e("input",{attrs:{type:"hidden",id:"url",name:"redirect_url",value:"https://ntisamerchant.wajesmarthrms.website/subscriptions/new/"}}),e("br"),e("input",{attrs:{type:"hidden",id:"cmdsubmit",name:"cmdsubmit",value:"Submit"}})])])])};s._withStripped=!0;var r={render:s,staticRenderFns:[]};a.a=r},vjS3:function(t,a,e){"use strict";a.a={layout:"main",computed:{filteredList:function(){var t=this;return this.licenses.filter(function(a){if(a.licensename.toLowerCase().includes(t.search.toLowerCase()))return a.licensename.toLowerCase().includes(t.search.toLowerCase())})}},data:function(){return{loading:!0,search:"",reference:"",formData:{merchID:"",transrefernce:"",licenseID:"",amount:"",subscriptiontype:""},txnref:"",status:"",errorData:{amount:!1,subscriptiontype:!1},modalData:{planname:"",amount:0},licenses:[],plan:{}}},methods:{validate:function(){if(""==this.formData.subscriptiontype)return this.errorData.subscriptiontype=!0,!0},getLicenses:function(){var t=this;this.$store.dispatch("license/getLicenses").then(function(a){if(a.data.status)return t.licenses=a.data.data,void(t.loading=!1);t.loading=!1,t.$toast.error("An error occurred")}).catch(function(a){t.loading=!1,t.$toast.error("An error occurred")})},subscribe:function(t){"Free Trial"!==t.licensename&&(this.clearData(),this.plan=t,this.modalData.planname=t.licensename,this.formData.licenseID=t.id,UIkit.modal("#subscription").toggle())},clearData:function(){this.plan={},this.formData.subscriptiontype="",this.modalData={planname:"",amount:0}},cancelModal:function(){this.errorData.subscriptiontype=!1,this.clearData(),UIkit.modal("#subscription").toggle("hide")},paySubscription:function(){if(!this.validate()&&(this.reference=this.generateRefNumber(10).toLowerCase(),confirm("Are you sure you want to subscribe to this license?"))){var t=this.modalData,a=this.user,e=this.reference,s=this;localStorage.setItem("licenseID",this.formData.licenseID),localStorage.setItem("amount",t.amount),localStorage.setItem("subscriptiontype",this.formData.subscriptiontype);var r=getpaidSetup({PBFPubKey:"FLWPUBK-9e6e22dec3b0cd3401d10fbcb3597b12-X",customer_email:a.merchantemailaddress,amount:t.amount,customer_phone:a.merchantphonenumber,customer_firstname:a.businessname,currency:"NGN",txref:e,onclose:function(){s.errorData.subscriptiontype=!1},callback:function(t){"00"==t.data.data.responsecode||"0"==t.data.data.responsecode?(s.$toast.success("Payment was successful"),s.merchantSubscription(t.data.tx)):s.$toast.error("An error occurred! Please try again or contact the administrator"),r.close()}})}},merchantSubscription:function(t){var a=this;this.formData.transrefernce=t.txRef,this.formData.amount=t.amount,this.$store.dispatch("license/merchantSubscription",this.formData).then(function(t){if(t.data.status)return a.$toast.success("Subscription successful"),a.cancelModal(),void a.$router.push("/subscriptions");a.$toast.error("An error occurred")}).catch(function(t){a.cancelModal(),a.$toast.error("An error occurred")})},getPlanAmount:function(t){var a=t.target.value;""!==a?"monthly"!==a?"quarterly"!==a?"yearly"!==a||(this.modalData.amount=this.plan.annuallypricing):this.modalData.amount=this.plan.quarterlypricing:this.modalData.amount=this.plan.monthlypricing:this.$toast.error("Please select a type")}},mounted:function(){this.formData.merchID=this.user.role?this.user.merchID:this.user.id,void 0!=this.$route.query.txnref&&void 0!=this.$route.query.status?("successful"==this.$route.query.status?(this.$toast.success("Transaction is being processed"),this.formData.transrefernce=this.$route.query.txnref,this.formData.licenseID=localStorage.getItem("licenseID"),this.formData.amount=localStorage.getItem("amount"),this.formData.subscriptiontype=localStorage.getItem("subscriptiontype"),this.merchantSubscription()):(this.$toast.error("Failed to process transaction"),this.getLicenses()),localStorage.removeItem("licenseID"),localStorage.removeItem("amount"),localStorage.removeItem("subscriptiontype")):this.getLicenses()}}}});